## This repository contains the simulation code, datasets and plotting code for the article "On the evolution of emergence patterns driven by environmental cycles"

## Overview

This repository is organised into two folders:

1. `SimulationCode` contains the code used for running simulations and regenerating the dataset required for creating the figures
2. `FigureSources` contains the scripts and corresponding data used for plotting the figures  

## Installing Julia 

Most code in this repository is written in the `Julia` programming language.
To run the simulations and replicate the code, one needs to install `Julia v1.10` and all its required packages and `Python v3.11` and all its required packages. 
As the code here was written for the respective version of the languages, we recommend that these versions are used to ensure perfect reproducibility.

1. Follow the instructions here: https://julialang.org/install/. This will install `juliaup`, the version manager for Julia and also the latest stable version of the Julia programming language. 
2. Install v1.10.2 of the language `juliaup add 1.10.2`. 
3. To make this the default version, run the command `juliaup default 1.10.2`. 
4. Otherwise, every time Julia is run, one would have to add `julia +1.10.2` in order to launch the desired version. 

## Installing required Julia packages

The required Julia environment with the specific versions of the necessary packages can be recreated with the `Project.toml` and `Manifest.toml` files. 
The process to do this is as follows:
1. Open a terminal in the directory of this repository
2. Launch a Julia REPL with: `julia --project=.`
3. Install all the packages with: `] instantiate`
4. Hit `backspace` to exit the package manager. Now you are ready to run the scripts in this repository.

## Installing Python
The script for Figure S1 is using `Python` v3.11. To reproduce this part, one needs to install `Python` and its required packages. It is recommended to install the same version of `Python` to ensure reproducibility.

1. Install (Mini)Conda: https://www.anaconda.com/docs/getting-started/miniconda/install
2. Install the packages written in environment file using the command: `conda env create --file environment.yaml --name emergence_patterns`.
3. Switch to the environment with `conda activate emergence_patterns` 

Alternatively, install python directly from here: https://www.python.org/downloads/release/python-3110/ followed by pip: https://pip.pypa.io/en/stable/installation/, and then install the required packages manually.

## SimulationCode

The file `replicator_mutator_emergence_patterns.jl`, which encloses the code to perform the simulations to generate the dataset required for creating the figures.
This file can be run, by first starting a Julia REPL as Step 1-2 above and running the following: `include("SimulationCode/replicator_mutator_emergence_patterns.jl")`.

The Julia script performs a root-finding / optimization calculation in order to find all valid and stable equilibrium solutions to the replicator-mutator equation representing the model of emergence patterns driven by environmental cycles. 
A solution, when plugged into the equations results in a value of zero. 
Since the equations are all zero at the solution, this can also be treated as a root-finding calculation in order to reduce the error. 
A couple of extra error terms are added to ensure validity and normalization of the solution.  
Classical Newton's method with multiple initial guesses are used to find all solutions for a combination of parameter values. 
Solutions to neighbouring points in parameter space are used as initial guesses for the minimization of new points to speed up the calculations. 
The code is also parallelized (multi-threaded) to further improve performance.

The files `figure_3`, `figure_4`, `figure_5`, and `figure_S3` contain the shell command to run the Julia script with the appropriate parameter values to generate data for the corresponding figures. 
These can be run by opening up a shell and running `SimulationCodes/figure_<x>`.
These will output the datasets of the results in the folder `Data/`. 
The outputted dataset is in a .jld2 format which is a binary file and is read using the JLD2.jl package. This is because the data is multidimensional and contains different kinds of information which is not easily stored in a tabular format. 

Upon running any code, it will write to file a dynamic progress bar which will give an estimate of how much time is remaining.

These datasets require a small amount of filtering in order to be used for plotting. 
Datasets which have already been filtered and organized and are provided in the folder `FigureSources`.

## FigureSources

This folder contains all the datasets generated by the simulation codes above and the scripts to plot them. 
The codes will display and save a pdf of the Figure corresponding to their names. 
To create the figures, first start a Julia REPL as above and run the following: `include("FigureSources/Figure_<number>.jl")`.
Here `<number>` is to be replaced by the number of the Figure required (except Figure 1).
This will create figures and save them in the folder `Figures/`

- Figure_2.svg is the editable vector graphics file that was used to create Figure 2, the illustration of the model.
- Figure_3.jl - Figure_5.jl and Figure_S2.jl uses data generated from the script `replicator_mutator_emergence_patterns.jl`, which uses root-finding calculations to find stable equilibrium solutions to the replicator-mutator equations.
- Figure_S1.py performs geometric convex Hull calculations in order to find the sizes of the basins of attraction of the different solutions. To run it, first activate the environment with `conda activate emergence_patterns` and run the following command: `python Figure_S1.py`. 